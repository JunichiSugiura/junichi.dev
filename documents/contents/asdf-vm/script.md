## Intro

ä»Šå›ã¯ asdf ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã£ã¦ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã‚’ä¸€æ‹¬ã§è¡Œãˆã‚‹ã‚ˆã†ã«ã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ï¼

ä»¥å‰æŠ•ç¨¿ã—ãŸ dotfiles ã®ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã«æ²¿ã£ãŸå½¢ã§ãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãã®ã§Homebrew Bundleã‚„Stowã®ä½¿ã„æ–¹ãªã©åˆ†ã‹ã‚‰ãªã„ç®‡æ‰€ãŒã‚ã£ãŸã‚‰ãœã²ãã¡ã‚‰ã®ãƒ“ãƒ‡ã‚ªã‚‚ãƒã‚§ãƒƒã‚¯ã—ã¦ã¿ã¦ãã ã•ã„ã€‚ãƒªãƒ³ã‚¯ã¯ç”»é¢å³ä¸Šã®ã‚¤ãƒ³ãƒ•ã‚©ãƒ‘ãƒãƒ«ã‹æ¦‚è¦æ¬„ã«å¼µã£ã¦ãŠãã¾ã™ã€‚ã‚‚ã—ã‚ˆã‹ã£ãŸã‚‰ç”»é¢å·¦ä¸‹ã®ãƒãƒ£ãƒ³ãƒãƒ«ç™»éŒ²ãƒœã‚¿ãƒ³ã‚‚æŠ¼ã—ã¦ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ãŸã ã‘ã‚‹ã¨åŠ©ã‹ã‚Šã¾ã™ ğŸ™

## ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã£ã¦ä½•?

ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ä½•ï¼Ÿã£ã¦æ–¹ã®ãŸã‚ã«ç°¡å˜ã«èª¬æ˜ã™ã‚‹ã¨ã€ ä¾‹ãˆã°æ¥­å‹™ã§ NodeJS ã‚’æ™®æ®µæ›¸ã„ã¦ã„ãŸã¨ã—ã¦ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¯ã«é•ã†ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®Nodeã‚’ä½¿ã‚ãªã‘ã‚Œã°ã„ã‘ãªã„ã“ã¨ãŒã¡ã‚‡ãã¡ã‚‡ãã‚ã‚Šã¾ã™ã€‚ãã†ã„ã£ãŸå ´åˆã«å¾“æ¥ã ã£ãŸã‚‰ nvm ã‚„ nodebrew ã¨ã„ã£ãŸãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†ã“ã¨ã§ç•°ãªã‚‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã® node ã‚’åŒæ™‚ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã‚ˆã£ã¦éšæ™‚åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚

ãŸã åƒ•ã®ã‚ˆã†ã« React Native ãªã©ã‚’ä½¿ã£ã¦é–‹ç™ºã—ã¦ã‚‹å ´åˆã¯ iOSã®ãƒ“ãƒ«ãƒ‰ç”¨ã«Rubyã‚’å…¥ã‚ŒãŸã‚Š, Android ç”¨ã« Java...ã¨ã„ã£ãŸã‚ˆã†ã«è¨€èªãŒå¢—ãˆã‚‹ãŸã³ã«(rbenvãªã‚Šjvmãªã‚Š)å€‹åˆ¥ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ãã“ã§asdfã®å‡ºç•ªã§ã™ã€‚

asdf ã¯æ§˜ã€…ãªãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸€æ‹¬ç®¡ç†ã™ã‚‹ãŸã‚ã® CLI ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

ã“ã®ãƒ„ãƒ¼ãƒ«ã«ã¯ plugin ã¨ã„ã†æ¦‚å¿µãŒå­˜åœ¨ã—ã¦ã„ã¦ã€NodeJS ã‚„ Rubyã€Python ãªã©æ§˜ã€…ãªç¨®é¡ãŒã™ã§ã«ç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚ã¾ãŸè‡ªåˆ†ã§æ–°ãŸã« plugin ã‚’ä½œæˆã—ã€GitHub ã‚’é€šã—ã¦ãƒ›ã‚¹ãƒˆã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

ã•ã‚‰ã« plugin ã®ä¸­ã«ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã ã‘ã§ã¯ãªãã€gcloud ã ã£ãŸã‚Š mysql ã¿ãŸã„ãªæ§˜ã€…ãªãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚

ã¾ãæ­£ç›´ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªãã‚‰ã„ã—ã‹ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç´°ã‹ãåˆ‡ã‚Šæ›¿ãˆã¦ã®ä½œæ¥­ã—ã¦ã„ãã“ã¨ã£ã¦ãªã„ã‹ãªã¨æ€ã†ã®ã§ã€å¾Œã®ã‚‚ã®ã¯ Homebrew ã§ç®¡ç†ã™ã‚Œã°è‰¯ã„ã‹ãªã¨æ€ã„ã¾ã™ã€‚

ã¨ã„ã†ã“ã¨ã§æ—©é€Ÿ asdf ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã€åƒ•ãŒæ™®æ®µä½¿ã£ã¦ã„ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã®é–‹ç™ºç’°å¢ƒã‚’æ•´ãˆã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚

## ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

### ã¾ãšã¯asdfã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

[docs](https://asdf-vm.com/#/core-manage-asdf?id=dependencies)

```sh
brew install asdf coreutils curl git
```

åƒ•ã¯dotfilesã®ä¸­ã«Brewfileã‚’ç”¨æ„ã—ã¦ã„ã‚‹ã®ã§ãã¡ã‚‰ã®æ–¹ã«è¨˜è¼‰ã—ã¦ã„ãã¾ã™ã€‚

[docs](https://asdf-vm.com/#/core-manage-asdf?id=add-to-your-shell)

æ¬¡ã«ã“ã®ã‚³ãƒãƒ³ãƒ‰ã‚’èµ°ã‚‰ã›ã¾ã™ã€‚

```sh
echo -e "\n. $(brew --prefix asdf)/asdf.sh" >> ~/.zshrc
```

ã™ã‚‹ã¨`.zshrc`ã«æ–°ãŸã«ãƒ©ã‚¤ãƒ³ãŒè¿½åŠ ã•ã‚ŒãŸã®ãŒç¢ºèªã§ãã‚‹ã‹ã¨æ€ã„ã¾ã™ã€‚

### asdf plugin ã®è¿½åŠ æ–¹æ³•

[docs](https://asdf-vm.com/#/core-manage-plugins?id=add)

```sh
asdf plugin add <plugin>
```
### Link .tool-versions

```sh
mkdir -p packages/asdf
touch packages/asdf/.tool-versions
```

```sh
# .tool-versions

nodejs 14.15.1
```

è¤‡æ•°ã®ãƒãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½¿ã„ãŸã„å ´åˆã¯æ¨ªã«ä¸¦ã¹ã¦æ›¸ã„ã¦ãŠãã¾ã™ã€‚

```sh
dotfiles

# ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒªãƒ³ã‚¯ã•ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
$ls -la ~/.tool-versions
```

### NodeJSã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

[docs](https://github.com/asdf-vm/asdf-nodejs#install)

NodeJS pluginã‚’ä½¿ã†ã£ã¦nodeãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å ´åˆã¯äºˆã‚ã‚­ãƒ¼ãƒªãƒ³ã‚°ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã€ã¾ãšã¯ãã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’èµ°ã‚‰ã›ã¾ã™ã€‚

`gpg`ã‚‚å¿…è¦ã«ãªã£ã¦ãã‚‹ã®ã§å…¥ã£ã¦ãªã„æ–¹ã¯äºˆã‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

```sh
bash -c '${ASDF_DATA_DIR:=$HOME/.asdf}/plugins/nodejs/bin/import-release-team-keyring'

asdf install nodejs
```

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®è‡ªå‹•åŒ–

æ¬¡ã¯ã“ã‚Œã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ãŸã‚ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ã„ã¦`dotfiels`èµ°ã‚‰ã‚‹ã ã‘ã§ç’°å¢ƒæ§‹ç¯‰ãŒçµ‚ã‚ã‚‹ã‚ˆã†ã«ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚ã¾ãŸ`.tool-verions`ã®å¤‰æ›´ã«ã‚‚å¯¾å¿œã§ãã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã¾ã™ã€‚

### Install Script
```sh
# shellcheck disable=SC2013
for plugin in $(awk '{print $1}' ~/.tool-versions); do
    if ! is_dir ~/.asdf/plugins/"$plugin"; then
        asdf plugin add "$plugin"
    fi
done

is_runtime_versions_changed() {
    plugin="$1"
    specified=$(grep "$plugin" ~/.tool-versions | awk '{$1=""; print $0}')

    installed=$(asdf list "$plugin" 2>&1)
    is_changed=
    for version in $specified; do
        match=$(echo "$installed" | grep "$version")
        [ -z "$match" ] && is_changed=1
    done

    [ "$is_changed" ]
}

for plugin in $(asdf plugin list); do
    if is_runtime_versions_changed "$plugin"; then
        if [ "$plugin" = nodejs ]; then
            log 'Import release team keyring for Node.JS'
            # more info -> https://github.com/asdf-vm/asdf-nodejs#install
            bash -c '${ASDF_DATA_DIR:=$HOME/.asdf}/plugins/nodejs/bin/import-release-team-keyring'
        fi

        log "Install runtime: $plugin"
        asdf install "$plugin"
    fi
done
``` 

### å¿…è¦ãªãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚’å…¨éƒ¨è¿½åŠ 

```sh
# .tool-versions

nodejs 14.15.1
yarn 1.22.10
golang 1.15
rust 1.47.0
deno 1.5.2
python 3.9.0 2.7.18
ruby 2.6.6
java adoptopenjdk-11.0.9+101
```

## Ending
ã„ã‹ãŒã ã£ãŸã§ã—ã‚‡ã†ã‹ï¼Ÿasdfã‚’ä½¿ã†ã“ã¨ã§ã‹ãªã‚Šã‚¹ãƒƒã‚­ãƒªã¨ã—ãŸdotfilesã«ä»•ä¸Šã’ã‚‹ã“ã¨ãŒå‡ºæ¥ãŸã‹ãªã¨æ€ã„ã¾ã™ã€‚

é¢ç™½ã‹ã£ãŸã¨ã„ã†æ–¹ã¯ãœã²ãƒãƒ£ãƒ³ãƒãƒ«ç™»éŒ²ã®æ–¹ã‚ˆã‚ã—ããŠã­ãŒã„ã—ã¾ã™ã€‚

ã˜ã‚ƒã‚ã¾ãŸã­ã€œ
